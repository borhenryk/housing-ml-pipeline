resources:
  jobs:
    housing_ml_training_job:
      name: "[${bundle.target}] Housing ML Training Pipeline"
      description: "End-to-end ML pipeline for housing price prediction"
      schedule:
        quartz_cron_expression: "0 0 8 * * ?"
        timezone_id: "America/Los_Angeles"
        pause_status: PAUSED
      email_notifications:
        on_failure:
          - ${workspace.current_user.userName}
      tasks:
        - task_key: data_preparation
          notebook_task:
            notebook_path: ../src/housing_ml/notebooks/01_data_preparation.py
            base_parameters:
              catalog: ${var.catalog}
              schema: ${var.schema}

        - task_key: feature_engineering
          depends_on:
            - task_key: data_preparation
          notebook_task:
            notebook_path: ../src/housing_ml/notebooks/02_feature_engineering.py
            base_parameters:
              catalog: ${var.catalog}
              schema: ${var.schema}

        - task_key: model_training
          depends_on:
            - task_key: feature_engineering
          notebook_task:
            notebook_path: ../src/housing_ml/notebooks/03_model_training.py
            base_parameters:
              catalog: ${var.catalog}
              schema: ${var.schema}

        - task_key: model_validation
          depends_on:
            - task_key: model_training
          notebook_task:
            notebook_path: ../src/housing_ml/notebooks/04_model_validation.py
            base_parameters:
              catalog: ${var.catalog}
              schema: ${var.schema}

        - task_key: model_deployment
          depends_on:
            - task_key: model_validation
          notebook_task:
            notebook_path: ../src/housing_ml/notebooks/05_model_deployment.py
            base_parameters:
              catalog: ${var.catalog}
              schema: ${var.schema}
              endpoint_name: ${var.serving_endpoint_name}
